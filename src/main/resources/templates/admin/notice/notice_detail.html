<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{include/layout}">
<meta charset="UTF-8">
<th:block layout:fragment="content">
	<link th:href="@{/css/admin/notice/notice_detail.css}" rel="stylesheet"
		type="text/css">
	<!-- 부트스트랩 아이콘을 사용하기 위한 링크 추가 -->
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.9.1/font/bootstrap-icons.min.css">

	<!-- CSRF 토큰 추가 -->
	<meta name="_csrf" th:content="${_csrf.token}"/>
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>

	<section>
		<h1>상세 보기</h1>
		<div class="detail_notice">
			<div class="notice-header">
				<h3 class="notice-title">
					제목 : <span th:text="${dto.notice_title}"></span>
				</h3>
				<p class="author" style="margin-bottom: -10px;">
					작성자 : <span th:text="${dto.member_name}+' 관리자'"></span>
				</p>
				<br>
				<p class="date">
					작성일 : <span th:text="${dto.notice_create_date}"></span>
				</p>
				<p class="modidate" th:if="${dto.notice_update_date != null}">
					수정일 : <span th:text="${dto.notice_update_date}"></span>
				</p>
			</div>
			<div class="notice-content">

				<div class="file-download-section"
					th:if="${dto.notice_ori_img != null}">

					<a th:text="${dto.notice_ori_img}"
						th:href="@{/download/{no}(no=${dto.notice_no})}" class="file-name">첨부파일</a>

					<a th:href="@{/download/{no}(no=${dto.notice_no})}"
						class="download-icon"> <i class="bi bi-download"
						style="font-size: 20px;"></i>
					</a>
				</div>

				<div class="notice-image" th:if="${dto.notice_new_img != null}">
					<img th:src="@{'/linkOfficeImg/' + ${dto.notice_new_img}}"
						alt="Notice Image">
				</div>

				<div class="notice-text">
					<div th:utext="${dto.notice_content}"></div>
				</div>
			</div>

			<div class="notice-buttons">
				<a th:href="@{/admin/notice/update/{no}(no=${dto.notice_no})}" class="btn btn-edit">수정</a>
				<a class="btn btn-delete" th:onclick="noticeDelete([[${dto.notice_no}]]);">삭제</a>
				<button class="btn btn-back" onclick="window.history.back();">목록</button>
			</div>
		</div>
	</section>
	<script>
	const noticeDelete = function(noticeNo) {
		
		Swal.fire({
			text: '삭제하시겠습니까?',
			icon: 'warning',
			showCancelButton: true,
			confirmButtonColor: '#EEB3B3',
			cancelButtonColor: '#C0C0C0',
			confirmButtonText: '삭제',
			cancelButtonText: '취소'
		}).then((result) => {
			if (result.isConfirmed) {
				// 삭제 확정 시
				const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
				const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

				fetch('/notice/' + noticeNo, {
					method: 'DELETE',
					headers: {
						'Content-Type': 'application/json',
						[csrfHeader]: csrfToken
					}
				})
				.then(response => response.json())
				.then(data => {
					if (data.res_code === '200') {
						Swal.fire({
							icon: 'success',
							text: data.res_msg,
							confirmButtonText: '닫기'
						}).then((result) => {
							location.href = '/admin/notice/list';
						});
					} else {
						Swal.fire({
							icon: 'error',
							text: data.res_msg,
							confirmButtonText: '닫기'
						});
					}
				})
				.catch(error => {
					Swal.fire({
						icon: 'error',
						text: '삭제 중 오류가 발생했습니다.',
						confirmButtonText: '닫기'
					});
				});
			}
		});
	};
	</script>
</th:block>
</html>